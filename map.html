<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8">
    <title>Dashboard SIG Pemalang</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="lib/flaticon/font/flaticon.css" rel="stylesheet">
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="css/map.css" rel="stylesheet">

    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/qgis2web.css">
    <link rel="stylesheet" href="css/fontawesome-all.min.css">

    <style>
        /* === PERBAIKAN HEADER & NAVBAR (FIX MASALAH WARNA GELAP) === */
        /* 1. Memaksa Navbar Menempel di Atas (Tidak Melayang) */
        /* Tambahan agar saat klik link, posisi scroll pas tidak tertutup navbar */
        
        #tabel-data {
            scroll-margin-top: 100px;
        }
        
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>

<body>
    <div class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a href="index.html" class="navbar-brand">PML</a>
            <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                <div class="navbar-nav ml-auto">
                    <a href="index.html" class="nav-item nav-link">Beranda</a>
                    <a href="index.html#about" class="nav-item nav-link">Latar Belakang</a>
                    <a href="map.html" class="nav-item nav-link active">Peta interaktif</a>
                    <a href="kontak.html" class="nav-item nav-link">Kontak</a>
                </div>
            </div>
        </div>
    </div>

    <div class="page-header">
        <div class="container text-center">
            <h2 style="color: white; font-size: 32px; font-weight: 700; margin: 0; letter-spacing: 1px;">
                Dashboard Sebaran Buah
            </h2>
            <p style="color: #f1f1f1; margin-top: 5px; font-size: 16px; opacity: 0.9;">
                Analisis Spasial Berbasis Topografi dan Komoditas
            </p>
        </div>
    </div>

    <div class="container-fluid px-0">
        <div class="dashboard-container">
            <div class="sidebar-map">
                <div class="sidebar-header">NAVIGASI WILAYAH</div>
                <div class="info-panel">
                    <strong>Korelasi Topografi & Komoditas:</strong>
                    <hr style="margin: 5px 0;">
                    <div class="info-item">
                        <span class="color-dot" style="background:#e31a1c;"></span>
                        <div><b>Zona Utara (Panas)</b><br>Cocok: <b>Mangga</b></div>
                    </div>
                    <div class="info-item">
                        <span class="color-dot" style="background:#FFD700;"></span>
                        <div><b>Zona Tengah (Sedang)</b><br>Cocok: <b>Rambutan</b></div>
                    </div>
                    <div class="info-item">
                        <span class="color-dot" style="background:#33a02c;"></span>
                        <div><b>Zona Selatan (Sejuk)</b><br>Cocok: <b>Alpukat</b></div>
                    </div>
                </div>
                <div class="district-list-container">
                    <ul class="district-list" id="districtList"></ul>
                </div>
            </div>
            <div id="map" style="width: 100%; min-height: 400px; z-index: 1;"></div>
        </div>
    </div>

    <div class="data-analysis-section" id="tabel-data">
        <div class="container">

            <div class="row justify-content-center mb-5">
                <div class="col-lg-10">
                    <div class="section-header text-center">
                        <p>Data Tabular</p>
                        <h2>Data Produksi Buah Tahun 2024</h2>
                    </div>

                    <div class="table-responsive shadow-effect">
                        <table class="table table-hover custom-table">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Kecamatan</th>
                                    <th><i class="fas fa-leaf"></i> Alpukat (Kw)</th>
                                    <th><i class="fas fa-fire"></i> Mangga (Kw)</th>
                                    <th><i class="fas fa-tree"></i> Rambutan (Kw)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td class="font-weight-bold">Pemalang</td>
                                    <td>19.5</td>
                                    <td class="highlight-red">22.698</td>
                                    <td>40</td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td class="font-weight-bold">Taman</td>
                                    <td>77</td>
                                    <td class="highlight-red">73.649</td>
                                    <td>1.018</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td class="font-weight-bold">Petarukan</td>
                                    <td>95</td>
                                    <td class="highlight-red">27.095</td>
                                    <td>0</td>
                                </tr>
                                <tr>
                                    <td>4</td>
                                    <td class="font-weight-bold">Comal</td>
                                    <td>0</td>
                                    <td class="highlight-red">3.050</td>
                                    <td>49</td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td class="font-weight-bold">Ulujami</td>
                                    <td>0</td>
                                    <td class="highlight-red">15.484</td>
                                    <td>0</td>
                                </tr>

                                <tr>
                                    <td>6</td>
                                    <td class="font-weight-bold">Ampelgading</td>
                                    <td>84</td>
                                    <td class="highlight-red">31.204</td>
                                    <td>148</td>
                                </tr>
                                <tr>
                                    <td>7</td>
                                    <td class="font-weight-bold">Bodeh</td>
                                    <td>263</td>
                                    <td class="highlight-red">1.235</td>
                                    <td>1.235</td>
                                </tr>
                                <tr>
                                    <td>8</td>
                                    <td class="font-weight-bold">Bantarbolang</td>
                                    <td>60</td>
                                    <td>3.438</td>
                                    <td class="highlight-yellow">50.254</td>
                                </tr>
                                <tr>
                                    <td>9</td>
                                    <td class="font-weight-bold">Randudongkal</td>
                                    <td>0</td>
                                    <td>150</td>
                                    <td class="highlight-yellow">356</td>
                                </tr>
                                <tr>
                                    <td>10</td>
                                    <td class="font-weight-bold">Warungpring</td>
                                    <td>127</td>
                                    <td>148</td>
                                    <td class="highlight-yellow">371</td>
                                </tr>
                                <tr>
                                    <td>11</td>
                                    <td class="font-weight-bold">Belik</td>
                                    <td class="highlight-green">34.560</td>
                                    <td>491</td>
                                    <td>23</td>
                                </tr>

                                <tr>
                                    <td>12</td>
                                    <td class="font-weight-bold">Moga</td>
                                    <td class="highlight-green">1.849</td>
                                    <td>741</td>
                                    <td>371</td>
                                </tr>
                                <tr>
                                    <td>13</td>
                                    <td class="font-weight-bold">Pulosari</td>
                                    <td class="highlight-green">2.805</td>
                                    <td>230</td>
                                    <td>46</td>
                                </tr>
                                <tr>
                                    <td>14</td>
                                    <td class="font-weight-bold">Watukumpul</td>
                                    <td class="highlight-green">10.428</td>
                                    <td>3.441</td>
                                    <td>910</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="source-link text-center mt-4">
                        <p class="text-muted mb-2">Ingin melihat data mentah selengkapnya?</p>
                        <a href="https://pemalangkab.bps.go.id/id/statistics-table/3/U0dKc1owczVSalJ5VFdOMWVETnlVRVJ6YlRJMFp6MDkjMyMzMzI3/produksi-tanaman-buah-buahan-dan-sayuran-tahunan-menurut-kecamatan-dan-jenis-tanaman-di-kabupaten-pemalang.html?year=2024" target="_blank"
                            class="btn btn-bps">
                            <i class="fas fa-external-link-alt"></i> Kunjungi BPS Kabupaten Pemalang
                        </a>
                    </div>
                </div>
            </div>

            <hr class="divider">

            <div class="row justify-content-center mt-5">
                <div class="col-lg-10">
                    <div class="section-header text-center">
                        <p>Hasil & Pembahasan</p>
                        <h2>Kesimpulan Analisis Spasial</h2>
                    </div>

                    <div class="conclusion-box">
                        <div class="conclusion-icon">
                            <i class="flaticon-education"></i>
                        </div>
                        <div class="conclusion-content">
                            <h4>Analisis Topografi & Komoditas</h4>
                            <p>
                                Berdasarkan visualisasi peta interaktif dan data tabular di atas, dapat disimpulkan bahwa kondisi topografi (ketinggian lahan) di Kabupaten Pemalang memiliki korelasi positif yang signifikan terhadap pola sebaran tanaman buah unggulan.
                            </p>
                            <ul class="conclusion-list">
                                <li>
                                    <span class="dot red"></span>
                                    <div>
                                        <strong>Zona Merah (Utara - Panas):</strong> Wilayah dataran rendah ( 100 mdpl) seperti Pemalang, Taman, dan Petarukan menjadi sentra produksi <strong>Mangga</strong> karena suhu panas memicu pembungaan optimal.>
                                    </div>
                                </li>
                                <li>
                                    <span class="dot yellow"></span>
                                    <div>
                                        <strong>Zona Kuning (Tengah - Sedang):</strong> Wilayah peralihan seperti Belik dan Bantarbolang memiliki kelembaban tinggi yang sangat cocok untuk produktivitas <strong>Rambutan</strong>.
                                    </div>
                                </li>
                                <li>
                                    <span class="dot green"></span>
                                    <div>
                                        <strong>Zona Hijau (Selatan - Sejuk):</strong> Wilayah pegunungan (> 400 mdpl) seperti Moga dan Pulosari menjadi habitat ideal tanaman subtropis seperti <strong>Alpukat</strong>.
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-5 col-md-6">
                    <div class="footer-contact">
                        <h2>SIG Pemalang</h2>
                        <p style="color: #dcdcdc; font-size: 14px; line-height: 1.8; margin-bottom: 20px;">
                            Sistem Informasi Geografis pemetaan potensi tanaman buah (Alpukat, Mangga, Rambutan) di Kabupaten Pemalang untuk mendukung perencanaan pertanian berbasis wilayah.
                        </p>
                        <p><i class="fa fa-map-marker-alt"></i> Pemalang, Jawa Tengah</p>
                        <p><i class="fa fa-phone-alt"></i> +62 851 5607 4723</p>
                        <p><i class="fa fa-envelope"></i> rohmanfatkhul946@gmail.com</p>
                        <div class="footer-social">
                            <a class="btn btn-custom" href="https://www.instagram.com/fatkhulrhm?igsh=MWJtb2Z0ajJtZnhqYQ==" target="_blank"><i class="fab fa-instagram"></i></a>
                            <a class="btn btn-custom" href="https://youtube.com/@03.amirilfatkhulrohman28?si=WrrSbTO9J5W5Aj5X" target="_blank"><i class="fab fa-youtube"></i></a>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="footer-link">
                        <h2>Menu Utama</h2>
                        <a href="index.html">Beranda</a>
                        <a href="#about">Latar Belakang</a>
                        <a href="map.html">Peta Interaktif</a>
                        <a href="kontak.html">Kontak</a>
                    </div>
                </div>

                <div class="col-lg-4 col-md-6">
                    <div class="footer-link">
                        <h2>Tautan Terkait</h2>
                        <a href="https://pemalangkab.bps.go.id" target="_blank">BPS Kab. Pemalang</a>
                        <a href="#">Dinas Pertanian</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="container copyright">
            <div class="row">
                <div class="col-md-6">
                    <p>&copy; <a href="#">SIG Pemalang</a>, All Right Reserved.</p>
                </div>
                <div class="col-md-6">
                    <p>Developed By <a href="#">Amiril Fatkhul Rohman</a></p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>

    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>

    <script src="data/LapakGIS_Batas_Kecamatan_2024_0.js"></script>

    <script>
        // 1. SETUP BASEMAP (OSM)
        var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        });

        var map = L.map('map', {
            zoomControl: true,
            maxZoom: 28,
            minZoom: 10,
            layers: [osm]
        });

        L.control.scale({
            imperial: false
        }).addTo(map);

        // Tombol Home
        var homeControl = L.Control.extend({
            options: {
                position: 'topleft'
            },
            onAdd: function(map) {
                var container = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-home');
                container.innerHTML = '<i class="fa fa-home" style="line-height:30px;"></i>';
                container.title = "Reset Tampilan";
                container.onclick = function() {
                    map.fitBounds(bounds_group.getBounds());
                }
                return container;
            }
        });
        map.addControl(new homeControl());

        // Legenda
        var legend = L.control({
            position: 'bottomright'
        });
        legend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'legend');
            div.innerHTML += '<h4>Legenda Zona</h4>';
            div.innerHTML += '<i style="background: #e31a1c"></i><span>Utara (Panas) - Mangga</span><br>';
            div.innerHTML += '<i style="background: #FFD700"></i><span>Tengah (Sedang) - Rambutan</span><br>';
            div.innerHTML += '<i style="background: #33a02c"></i><span>Selatan (Sejuk) - Alpukat</span><br>';
            return div;
        };
        legend.addTo(map);

        // LOGIKA PETA
        var hash = new L.Hash(map);
        var autolinker = new Autolinker({
            truncate: {
                length: 30,
                location: 'smart'
            }
        });
        var bounds_group = new L.featureGroup([]);

        function style_LapakGIS_Batas_Kecamatan_2024_0_0(feature) {
            switch (String(feature.properties['WADMKC'])) {
                case 'Pemalang':
                case 'Taman':
                case 'Petarukan':
                case 'Comal':
                case 'Bodeh':
                case 'Ulujami':
                case 'Ampelgading':
                    return {
                        opacity: 1,
                        color: 'rgba(35,35,35,1.0)',
                        fillColor: '#e31a1c',
                        fillOpacity: 0.8,
                        fill: true,
                        weight: 1
                    }

                case 'Bantarbolang':
                case 'Randudongkal':
                case 'Warungpring':
                    return {
                        opacity: 1,
                        color: 'rgba(35,35,35,1.0)',
                        fillColor: '#FFD700',
                        fillOpacity: 0.8,
                        fill: true,
                        weight: 1
                    }
                case 'Moga':
                case 'Pulosari':
                case 'Watukumpul':
                case 'Belik':
                    return {
                        opacity: 1,
                        color: 'rgba(35,35,35,1.0)',
                        fillColor: '#33a02c',
                        fillOpacity: 0.8,
                        fill: true,
                        weight: 1
                    }
                default:
                    return {
                        opacity: 1,
                        color: 'rgba(35,35,35,1.0)',
                        fillColor: '#aaaaaa',
                        fillOpacity: 0.8,
                        fill: true,
                        weight: 1
                    }
            }
        }

        function pop_LapakGIS_Batas_Kecamatan_2024_0(feature, layer) {
            var popupContent = '<table>\
                    <tr><td colspan="2" style="font-size:14px; color:#FDBE33; background:#333; padding:5px;"><strong>' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').toLocaleString()) : '') + '</strong></td></tr>\
                    <tr><th scope="row">Rambutan</th><td>' + (feature.properties['rambutan'] !== null ? autolinker.link(String(feature.properties['rambutan']).replace(/'/g, '\'').toLocaleString()) : '') + ' Kw</td></tr>\
                    <tr><th scope="row">Mangga</th><td>' + (feature.properties['mangga'] !== null ? autolinker.link(String(feature.properties['mangga']).replace(/'/g, '\'').toLocaleString()) : '') + ' Kw</td></tr>\
                    <tr><th scope="row">Alpukat</th><td>' + (feature.properties['alpukat'] !== null ? autolinker.link(String(feature.properties['alpukat']).replace(/'/g, '\'').toLocaleString()) : '') + ' Kw</td></tr>\
                </table>';
            layer.bindPopup(popupContent, {
                maxHeight: 400
            });
        }

        // Memuat Layer
        map.createPane('pane_LapakGIS_Batas_Kecamatan_2024_0');
        map.getPane('pane_LapakGIS_Batas_Kecamatan_2024_0').style.zIndex = 400;
        map.getPane('pane_LapakGIS_Batas_Kecamatan_2024_0').style['mix-blend-mode'] = 'normal';

        var layer_LapakGIS_Batas_Kecamatan_2024_0 = new L.geoJson(json_LapakGIS_Batas_Kecamatan_2024_0, {
            attribution: '',
            interactive: true,
            dataVar: 'json_LapakGIS_Batas_Kecamatan_2024_0',
            layerName: 'layer_LapakGIS_Batas_Kecamatan_2024_0',
            pane: 'pane_LapakGIS_Batas_Kecamatan_2024_0',
            onEachFeature: pop_LapakGIS_Batas_Kecamatan_2024_0,
            style: style_LapakGIS_Batas_Kecamatan_2024_0_0,
        });
        bounds_group.addLayer(layer_LapakGIS_Batas_Kecamatan_2024_0);
        map.addLayer(layer_LapakGIS_Batas_Kecamatan_2024_0);

        layer_LapakGIS_Batas_Kecamatan_2024_0.eachLayer(function(layer) {
            if (layer.feature.properties['WADMKC']) {
                layer.bindTooltip(layer.feature.properties['WADMKC'], {
                    permanent: true,
                    direction: "center",
                    className: 'label-style'
                });
            }
        });

        map.fitBounds(bounds_group.getBounds());

        // Automasi Sidebar
        var listContainer = document.getElementById('districtList');
        var features = json_LapakGIS_Batas_Kecamatan_2024_0.features;
        features.sort(function(a, b) {
            return a.properties.WADMKC.localeCompare(b.properties.WADMKC);
        });

        features.forEach(function(feature) {
            var prop = feature.properties;
            var li = document.createElement('li');
            li.innerHTML = "<span>" + prop.WADMKC + "</span> <i class='fa fa-chevron-right' style='font-size:10px; margin-top:5px;'></i>";
            li.onclick = function() {
                layer_LapakGIS_Batas_Kecamatan_2024_0.eachLayer(function(layer) {
                    if (layer.feature.properties.WADMKC === prop.WADMKC) {
                        map.flyToBounds(layer.getBounds(), {
                            padding: [50, 50],
                            duration: 1.5
                        });
                        layer.openPopup();
                    }
                });
            };
            listContainer.appendChild(li);
        });
    </script>
</body>

</html>